#include "EmonLib.h"                   // Include Emon Library
#include "time.h"
EnergyMonitor emon1;                   // Create an instance
float tim=0;
float energy[3];
float sumation=0;
int units=220;
float unitsperday;
float day=30;
int d=10000;
float real= 0;

String SUM;
void setup()
{  
  Serial.begin(115200);
 
  emon1.current(5, 54.67);             // Current: input pin, calibration.
  //calibration is explained bellow
}
 
void loop()
{
  double Irms = emon1.calcIrms(1480);  // Calculate Irms only
  Serial.print("power: ");
  Serial.print(Irms*220.0,6);         // Apparent power
  Serial.print("\ncurrent in Amperes: ");
  Serial.println(Irms,6);
  tim=millis();
  Serial.print("time in hours: ");
  Serial.println(tim/(3600000.0),6);
  energy[0]= Irms*220*(tim/(3600000.0));
  Serial.print("energy in watt per hour: ");
  Serial.println(energy[0],6);
  Serial.print("total sum: ");
  Serial.println(sum(energy[0]),6);
  SUM=sum(energy[0]);
  Serial.print("percentage of used appliance: ");
  Serial.println(percentage(energy[0],sum(energy[0])));
  Serial.print("monthly units to be input by user");
  Serial.print("permissible units everyday: ");
  unitsperday=units/30;
  Serial.print(unitsperday);
  Serial.print("\nunits left daily: ");
  Serial.print(left(unitsperday,day),sum(energy[0]));
  Serial.print("\n*************\n");
  delay(d);
}


float percentage(float z, float s)
{
   float per= (z/s)*100;
   return(per);
}
float sum(float k)
{
  sumation= sumation+k;
  return(sumation);
}

float average_units_per_day(float u, float v)
{
  float average= u/v;
  return(average);
}
float left(float x, float y)
{
  float remained= x-y;
  return(remained);
}